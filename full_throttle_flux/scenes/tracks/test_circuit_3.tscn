[gd_scene load_steps=11 format=3 uid="uid://iok12nc8qm3o"]

[ext_resource type="PackedScene" uid="uid://cs3rwb27lu2ct" path="res://scenes/start_finish_line.tscn" id="1_ut6yf"]
[ext_resource type="Script" uid="uid://do1bpsq8pkyxk" path="res://scripts/tracks/starting_grid.gd" id="2_750ah"]
[ext_resource type="Material" uid="uid://f5edkxv6sao2" path="res://shaders/resources/grid_material.tres" id="3_750ah"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_8a1g2"]
sky_top_color = Color(0.05, 0.05, 0.15, 1)
sky_horizon_color = Color(0.2, 0.15, 0.3, 1)
ground_bottom_color = Color(0.02, 0.02, 0.05, 1)
ground_horizon_color = Color(0.2, 0.15, 0.3, 1)

[sub_resource type="Sky" id="Sky_xfmcy"]
sky_material = SubResource("ProceduralSkyMaterial_8a1g2")

[sub_resource type="Environment" id="Environment_cxd56"]
background_mode = 2
sky = SubResource("Sky_xfmcy")
ambient_light_source = 2
ambient_light_color = Color(0.25, 0.25, 0.35, 1)
ambient_light_energy = 0.4
tonemap_mode = 2
glow_enabled = true
glow_intensity = 0.6
glow_bloom = 0.2

[sub_resource type="Curve3D" id="Curve3D_8254d"]
closed = true
_data = {
"points": PackedVector3Array(0, 0, 0, 0, 0, 0, 0.15372086, -0.17949677, 0.7944069, 178.47644, 0, -3.4262443, -178.47644, 0, 3.4262443, -263.33514, -0.1796875, 5.33923, 170.75299, -28.126465, -77.34113, -170.75299, 28.126465, 77.34113, -641.70026, -0.1796875, 180.40375, 86.26782, 7.6412315, 90.65543, -86.26782, -7.6412315, -90.65543, -1062.3562, 51.416016, 147.84439, -47.153076, 5.56201, 102.4205, 47.153076, -5.56201, -102.4205, -1021.948, -0.1796875, -145.25394, -52.22882, -2.700305, 66.8826, 52.22882, 2.700305, -66.8826, -996.53546, -11.462578, -345.731, -49.76758, -3.528885, 51.939056, 49.76758, 3.528885, -51.939056, -971.6334, -0.1796875, -495.49454, 35.66919, -4.901922, 54.545837, -35.66919, 4.901922, -54.545837, -1025.4548, -0.1796875, -693.72327, -60.844482, -0.000289917, 55.43506, 60.844482, 0.000289917, -55.43506, -1051.8086, 25.580368, -873.69147, -137.52405, 0, 57.754883, 137.52405, 0, -57.754883, -737.9934, -0.1796875, -881.5631, -19.082642, 0, -40.56964, 19.082642, 0, 40.56964, -495.5603, -10.622162, -790.7251, -97.84656, 0, 3.7614136, 97.84656, 0, -3.7614136, -413.33508, 7.532898, -622.2313, 10.744476, 0, 46.56836, -10.744476, 0, -46.56836, -394.18665, -0.1796875, -792.72595, -52.87204, -1.4901161e-08, 35.674744, 52.87204, 1.4901161e-08, -35.674744, -365.10583, -0.17968751, -934.9189, -28.885864, 0, -31.51184, 28.885864, 0, 31.51184, -206.40656, -0.1796875, -903.1058, -25.977966, 1.4901161e-08, -65.10077, 25.977966, -1.4901161e-08, 65.10077, -170.16794, -0.1796875, -792.02655, -11.785133, 1.4901161e-08, -52.63745, 11.785133, -1.4901161e-08, 52.63745, -102.711876, -0.17968751, -704.46344, -9.381073, 0, -80.26099, 9.381073, 0, 80.26099, -244.41962, -0.1796875, -452.66522, -93.499985, 0.00035095215, -12.298767, 93.499985, -0.00035095215, 12.298767, -36.079224, 23.76123, -305.78873, 7.3527527, 0, 57.509125, -7.3527527, 0, -57.509125, 159.2942, 40.06201, -463.87314, 40.440216, 0, -14.968079, -40.440216, 0, 14.968079, 54.254745, -0.1796875, -521.6449, -32.82483, 0, -39.91501, 32.82483, 0, 39.91501, 21.69249, -0.1796875, -404.78842, -73.26691, 0, -50.102386, 73.26691, 0, 50.102386, 258.4111, -0.1796875, -290.31113, 50.216248, 0, -65.67193, -50.216248, 0, 65.67193, 397.41528, -0.1796875, 8.590854, 56.747574, 0, -13.654474, -56.747574, 0, 13.654474, 253.30852, -0.1796875, -3.510944, 56.721283, 0, 4.4641743, -56.721283, 0, -4.4641743, 154.83403, -0.1796875, 0.16543418),
"tilts": PackedFloat32Array(0, 0, 0.17453292, 0.34906584, 0.17453292, 0.17453292, -0.08726646, 0.17453292, 0.5235988, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
}
point_count = 26

[sub_resource type="Shader" id="Shader_242es"]
code = "shader_type spatial;

uniform vec4 grid_color : source_color = vec4(0.0, 0.8, 1.0, 1.0);  // Cyan
uniform vec4 background_color : source_color = vec4(0.05, 0.05, 0.1, 1.0);  // Dark blue
uniform float grid_size : hint_range(0.1, 10.0) = 1.0;  // Size of each grid square
uniform float line_width : hint_range(0.01, 0.5) = 0.05;  // Thickness of lines
uniform float major_grid_every : hint_range(0.0, 20.0) = 5.0;  // Thicker line every N squares
uniform float major_line_width : hint_range(0.01, 1.0) = 0.1;

void fragment() {
    // Get world position (UV * object scale)
    vec2 pos = UV * 100.0;  // Adjust 100.0 to match your track scale

    // Calculate grid
    vec2 grid = abs(fract(pos / grid_size - 0.5) - 0.5) / fwidth(pos / grid_size);
    float line = min(grid.x, grid.y);

    // Major grid lines
    vec2 major_grid = abs(fract(pos / (grid_size * major_grid_every) - 0.5) - 0.5) / fwidth(pos / (grid_size * major_grid_every));
    float major_line = min(major_grid.x, major_grid.y);

    // Combine lines
    float grid_mask = 1.0 - min(line / line_width, 1.0);
    float major_mask = 1.0 - min(major_line / major_line_width, 1.0);

    // Mix colors
    vec3 color = background_color.rgb;
    color = mix(color, grid_color.rgb, grid_mask * 0.3);  // Regular grid
    color = mix(color, grid_color.rgb, major_mask * 0.6);  // Major grid brighter

    ALBEDO = color;
    ROUGHNESS = 0.8;
    METALLIC = 0.0;
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_h2vpo"]
render_priority = 0
shader = SubResource("Shader_242es")
shader_parameter/grid_color = Color(0, 0.8, 1, 1)
shader_parameter/background_color = Color(0.05, 0.05, 0.1, 1)
shader_parameter/grid_size = 10.0
shader_parameter/line_width = 0.5
shader_parameter/major_grid_every = 10.000000475
shader_parameter/major_line_width = 1.0

[sub_resource type="ShaderMaterial" id="ShaderMaterial_nrqn6"]
render_priority = 0
shader = SubResource("Shader_242es")
shader_parameter/grid_color = Color(0, 0.8, 1, 1)
shader_parameter/background_color = Color(0.05, 0.05, 0.1, 1)
shader_parameter/grid_size = 10.0
shader_parameter/line_width = 0.5
shader_parameter/major_grid_every = 10.000000475
shader_parameter/major_line_width = 1.0

[node name="TestCircuit3" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_cxd56")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(-0.866023, -0.433016, 0.250001, 0, 0.499998, 0.866027, -0.500003, 0.749999, -0.43301, 0, 50, 0)
light_color = Color(1, 0.95, 0.9, 1)
shadow_enabled = true
shadow_blur = 2.0

[node name="StartingPoint" type="Node" parent="."]

[node name="StartFinishLine" parent="StartingPoint" instance=ExtResource("1_ut6yf")]
transform = Transform3D(-4.371139e-08, 0, 1, 0, 1, 0, -1, 0, -4.371139e-08, 0, 2.6881704, 0)

[node name="StartingGrid" type="Node3D" parent="StartingPoint"]
transform = Transform3D(-4.3711392e-08, 0, 1.0000001, 0, 0.99999994, 0, -1.0000001, 0, -4.3711392e-08, 0, 0, 0)
script = ExtResource("2_750ah")
metadata/_custom_type_script = "uid://do1bpsq8pkyxk"

[node name="Slot1" type="Marker3D" parent="StartingPoint/StartingGrid"]
transform = Transform3D(0.9999999, 0, 0, 0, 1, 0, 0, 0, 0.9999999, -5.684342e-14, 6.7302732, 14.1989565)
gizmo_extents = 3.25

[node name="MainSpline" type="Path3D" parent="."]
curve = SubResource("Curve3D_8254d")

[node name="groundGeo" type="CSGPolygon3D" parent="MainSpline"]
transform = Transform3D(1, 0, 0, 0, 0.999836, -0.0181155, 0, 0.0181155, 0.999836, -0.22576904, 3.8146973e-06, -0.1640625)
use_collision = true
polygon = PackedVector2Array(21.58349, 2.9622357, 17.218266, 2.0412953, -16.617033, 1.8802173, -20.253164, 2.7683895, -20.286919, -1.9581314, 21.968796, -1.8501513)
mode = 2
path_node = NodePath("..")
path_interval_type = 0
path_interval = 0.5
path_simplify_angle = 1.0
path_rotation = 2
path_rotation_accurate = true
path_local = false
path_continuous_u = true
path_u_distance = 100.0
path_joined = true
smooth_faces = true
material = ExtResource("3_750ah")

[node name="wallLeftGeo" type="CSGPolygon3D" parent="MainSpline"]
transform = Transform3D(1, 0, 0, 0, 0.999836, -0.0181155, 0, 0.0181155, 0.999836, 0, 0, 0)
use_collision = true
collision_layer = 4
polygon = PackedVector2Array(28.489079, 8.5183115, 23.549274, 8.43313, 21.121952, 6.5165105, 21.079365, -2.1295757, 28.65942, -2.172171)
mode = 2
path_node = NodePath("..")
path_interval_type = 0
path_interval = 1.0
path_simplify_angle = 1.0
path_rotation = 2
path_rotation_accurate = false
path_local = false
path_continuous_u = true
path_u_distance = 50.0
path_joined = false
material = SubResource("ShaderMaterial_h2vpo")

[node name="wallRightGeo" type="CSGPolygon3D" parent="MainSpline"]
transform = Transform3D(1, 0, 0, 0, 0.999836, -0.0181155, 0, 0.0181155, 0.999836, 0, 0, 0)
use_collision = true
collision_layer = 4
polygon = PackedVector2Array(-19.290813, 6.090594, -22.31432, 7.922032, -27.509634, 7.922032, -27.211542, -2.640679, -19.120472, -2.5129018)
mode = 2
path_node = NodePath("..")
path_interval_type = 0
path_interval = 1.0
path_simplify_angle = 1.0
path_rotation = 2
path_rotation_accurate = false
path_local = false
path_continuous_u = true
path_u_distance = 50.0
path_joined = false
material = SubResource("ShaderMaterial_nrqn6")
